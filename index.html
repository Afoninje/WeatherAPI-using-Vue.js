<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.js"></script>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
  </head>

  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous"
  />
  <style>
    [v-cloak] {
      display: none;
    }
  </style>

  <body>
    <div id="app">
      <div class="container">
      <form class="mt-5">
        <div class="form-group">
          <button
            type="submit"
            @click.prevent="myFunction()"
            class="btn btn-primary"
          >
            Click Here To Get Information About Your Current Location
          </button>
        </div>
      </div>
      </form>
      <div id="app" v-cloak v-show="usersubmitted">
        <div class="container">
          <div class="card mt-5">
            <h2 class="card-header">Your Current Location</h2>
            <table class="table">
              <thead class="thead-dark">
                <th>Current Temperature:</th>
                <th>Description:</th>
                <th>Current Pressure:</th>
                <th>Current Humidity:</th>
              </thead>
              <tbody>
                <tr>
                  <td>{{usertemp}}°C</td>
                  <td>{{userdesc}}</td>
                  <td>{{userpressure}}</td>
                  <td>{{userhumidity}}%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="container">
        <form class="mt-5">
          <div class="form-group">
            <label>Search for City</label>
            <input
              type="text"
              v-model="citycopy"
              id="citysearch"
              class="form-control form-control-lg"
            />
          </div>

          <button
            type="submit"
            @click.prevent="process"
            class="btn btn-primary"
          >
            Submit
          </button>
        </form>

        <div id="app" v-show="submitted" v-cloak>
          <div class="container">
            <div class="card mt-5">
              <h2 class="card-header">Information for: {{city}}</h2>
              <table class="table">
                <thead class="thead-dark">
                  <th></th>
                  <th>Time Of Last Observation (GMT):</th>
                  <th>Current Temperature Of The City:</th>
                  <th>Current Date & Local Time:</th>
                  <th>Humidity:</th>
                </thead>
                <tbody>
                  <tr>
                    <td><img :src="icon" /></td>
                    <td>{{observation_time}}</td>
                    <td>{{temperature}}°C</td>
                    <td>{{localtime}}</td>
                    <td>{{humidity}}%</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
      var apiKey = "d96d6ea71d0d515f00a47cb5b4e4b67";
      var url =
        "https://api.weatherstack.com/current?access_key=" + apiKey + "f&query=";
      var urlcopy =
        "https://api.weatherstack.com/current?access_key=" + apiKey + "f&query=";

      var vm = new Vue({
        el: "#app",
        vuetify: new Vuetify(),
        data: {
          city: "",
          citycopy: "",
          submitted: false,
          usersubmitted: false,
          observation_time: "",
          temperature: "",
          localtime: "",
          icon: "",
          humidity: "",
          error: "",
          lat: "",
          lon: "",
          userdesc: "",
          usertemp: "",
          userpressure: "",
          userhumidity: "",
        },

        methods: {
          process: function () {
            this.submitted = true;
            vm.city = vm.citycopy;
            url = url + vm.city;

            axios.get(url).then(function (res) {
              console.clear();
              console.log(res);

              vm.city = res.data.location.name;
              vm.observation_time = res.data.current.observation_time;
              vm.temperature = res.data.current.temperature;
              vm.localtime = res.data.location.localtime;
              vm.icon = res.data.current.weather_icons;
              vm.humidity = res.data.current.humidity;

              url = urlcopy;
            });
          },

          myFunction: function () {
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(this.showPosition);
            } else {
              this.error = "Geolocation is not supported.";
            }
          },
          showPosition: function (position) {
            this.lat = position.coords.latitude;
            this.lon = position.coords.longitude;

            axios
              .get(
                "https://api.openweathermap.org/data/2.5/weather?lat=" +
                  this.lat +
                  "&lon=" +
                  this.lon +
                  "&appid=ad59e4fb24b7f88d5eaf006cc977159e"
              )
              .then(function (res2) {
                console.clear();
                console.log(res2);

                vm.userdesc = res2.data.weather[0].description;
                vm.userhumidity = res2.data.main.humidity;
                vm.userpressure = res2.data.main.pressure;
                vm.usertemp = res2.data.main.temp;
                vm.usertemp = vm.usertemp - 273.15;
              });
            this.usersubmitted = true;
          },
        },
      });
    </script>
  </body>
</html>
